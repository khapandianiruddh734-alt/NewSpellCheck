<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Achievers | Data Entry & Pro PDF Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
    
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { background-color: #f3f4f6; font-family: 'Inter', sans-serif; }
        .tool-card { transition: transform 0.2s, box-shadow 0.2s; }
        .tool-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #4f46e5; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Editor Layout Styles */
        #editor-container-main { display: flex; height: 75vh; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; background: #fff; }
        #thumbnail-sidebar { width: 140px; background: #ffffff; border-right: 1px solid #e5e7eb; overflow-y: auto; padding: 10px; }
        .thumb-page { border: 2px solid #e5e7eb; margin-bottom: 10px; cursor: pointer; border-radius: 4px; background: #f9fafb; position: relative; }
        .thumb-page.active { border-color: #ef4444; }
        #editor-viewport { flex: 1; overflow: auto; display: flex; flex-direction: column; align-items: center; background: #e2e8f0; padding: 20px; }
        .page-wrapper { position: relative; margin-bottom: 30px; background: white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .canvas-container { position: absolute !important; top: 0; left: 0; }
    </style>
</head>
<body class="text-gray-800 min-h-screen flex flex-col">

    <nav class="bg-white shadow z-50">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center cursor-pointer" onclick="location.reload()">
                    <span class="text-2xl font-bold text-indigo-600">The <span class="text-gray-800">Achievers</span></span>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex-grow max-w-7xl mx-auto px-4 py-12 w-full">
        <div id="menu-view">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <div>
                    <h2 class="text-gray-500 font-bold tracking-wider text-sm mb-4 uppercase">PDF Tools</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div onclick="loadTool('pdf-editor')" class="tool-card bg-white p-4 rounded-lg shadow cursor-pointer flex items-center space-x-4 border-l-4 border-indigo-600">
                            <div class="bg-indigo-100 p-3 rounded text-indigo-600">‚úçÔ∏è</div>
                            <div><h3 class="font-bold">PDF Editor</h3><p class="text-xs text-gray-400">Add text & images</p></div>
                        </div>
                        <div onclick="loadTool('jpg-to-pdf')" class="tool-card bg-white p-4 rounded-lg shadow cursor-pointer flex items-center space-x-4">
                            <div class="bg-yellow-100 p-3 rounded text-yellow-600">üñºÔ∏è</div>
                            <div><h3 class="font-bold">JPG to PDF</h3></div>
                        </div>
                        <div onclick="loadTool('compress-pdf')" class="tool-card bg-white p-4 rounded-lg shadow cursor-pointer flex items-center space-x-4">
                            <div class="bg-teal-100 p-3 rounded text-teal-600">üìâ</div>
                            <div><h3 class="font-bold">Compress PDF</h3></div>
                        </div>
                    </div>
                </div>

                <div>
                    <h2 class="text-gray-500 font-bold tracking-wider text-sm mb-4 uppercase">Data Tools</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div onclick="loadTool('menu-fixer')" class="tool-card bg-white p-4 rounded-lg shadow cursor-pointer flex items-center space-x-4 border-l-4 border-pink-500">
                            <div class="bg-pink-100 p-3 rounded text-pink-600">üçî</div>
                            <div><h3 class="font-bold">Menu Fixer</h3></div>
                        </div>
                        <div onclick="loadTool('duplicate-remover')" class="tool-card bg-white p-4 rounded-lg shadow cursor-pointer flex items-center space-x-4">
                            <div class="bg-orange-100 p-3 rounded text-orange-600">üìã</div>
                            <div><h3 class="font-bold">Duplicate Remover</h3></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="workspace-view" class="hidden bg-white rounded-xl shadow-lg border border-gray-100 p-8 text-center max-w-6xl mx-auto mt-8">
            <button onclick="location.reload()" class="text-sm text-indigo-500 hover:underline mb-6 block text-left">‚Üê Back to Dashboard</button>
            <h1 id="tool-title" class="text-3xl font-bold text-gray-800 mb-2">Tool Name</h1>
            <p id="tool-desc" class="text-gray-500 mb-8">Description</p>

            <div id="drop-area" class="border-2 border-dashed border-indigo-300 rounded-xl bg-indigo-50 p-12 cursor-pointer hover:bg-indigo-100 transition" onclick="document.getElementById('file-input').click()">
                <div class="flex flex-col items-center text-indigo-900">
                    <i class="fas fa-cloud-upload-alt text-4xl mb-4"></i>
                    <span class="text-lg font-semibold">Click to Add File(s)</span>
                    <span id="file-formats" class="text-xs mt-1">Supported formats...</span>
                </div>
                <input type="file" id="file-input" class="hidden" onchange="handleFile(this.files)">
            </div>

            <div id="editor-ui" class="hidden">
                <div class="bg-gray-50 border p-3 flex items-center gap-4 rounded-t-lg">
                    <select id="font-family" class="border rounded px-2 py-1 text-xs">
                        <option value="Arial">Arial</option>
                        <option value="Times New Roman">Times New Roman</option>
                    </select>
                    <select id="font-size" class="border rounded px-2 py-1 text-xs">
                        <option value="12">12px</option>
                        <option value="24" selected>24px</option>
                    </select>
                    <button onclick="addText()" class="bg-indigo-600 text-white px-3 py-1 rounded text-xs font-bold">Add Text</button>
                    <button onclick="document.getElementById('editor-img').click()" class="bg-indigo-600 text-white px-3 py-1 rounded text-xs font-bold">Add Image</button>
                    <button onclick="deleteSelected()" class="bg-red-500 text-white px-3 py-1 rounded text-xs font-bold">Delete</button>
                    <input type="file" id="editor-img" class="hidden" accept="image/*" onchange="processEditorImage(this)">
                </div>
                <div id="editor-container-main">
                    <aside id="thumbnail-sidebar"></aside>
                    <main id="editor-viewport"><div id="pages-container"></div></main>
                </div>
                <div class="p-4 border-t bg-gray-50 rounded-b-lg flex justify-between items-center">
                    <span id="page-info" class="text-sm font-bold">Page 0 / 0</span>
                    <div class="flex gap-2">
                        <button onclick="adjustZoom(-0.1)" class="p-2 border rounded"><i class="fas fa-search-minus"></i></button>
                        <button onclick="adjustZoom(0.1)" class="p-2 border rounded"><i class="fas fa-search-plus"></i></button>
                    </div>
                    <button onclick="exportFinalPDF()" id="export-btn" class="bg-red-600 text-white px-8 py-2 rounded-full font-bold">EXPORT PDF</button>
                </div>
            </div>

            <div id="status-area" class="mt-8 hidden">
                <div id="loading-spinner" class="hidden flex justify-center items-center mb-4 text-indigo-600">
                    <div class="loader"></div><span class="ml-3 font-medium">Processing...</span>
                </div>
                <div id="success-msg" class="hidden">
                    <p class="text-green-600 font-bold text-lg mb-4">üéâ Process Complete!</p>
                    <button id="download-btn" class="bg-indigo-600 text-white px-8 py-3 rounded-lg font-bold transition">Download Result</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { PDFDocument } = PDFLib;
        let currentTool = null;
        let fabricCanvases = [];
        let activePage = 0;
        let originalPdfBytes;
        let scaleZoom = 1.0;

        const tools = {
            'pdf-editor': { id: 'pdf-editor', title: "PDF Editor", desc: "Annotate PDF pages.", accept: ".pdf", handler: startPdfEditor },
            'jpg-to-pdf': { id: 'jpg-to-pdf', title: "JPG to PDF", desc: "Combine images.", accept: "image/*", handler: convertJpgToPdf, multiple: true },
            'compress-pdf': { id: 'compress-pdf', title: "Compress PDF", desc: "Reduce size.", accept: ".pdf", handler: compressPDF },
            'menu-fixer': { id: 'menu-fixer', title: "Menu Fixer", desc: "Fix typos.", accept: ".xlsx", handler: processMenuFixer },
            'duplicate-remover': { id: 'duplicate-remover', title: "Duplicate Remover", desc: "Clean data.", accept: ".xlsx", handler: null }
        };

        function loadTool(id) {
            currentTool = tools[id];
            resetUI();
            document.getElementById('menu-view').classList.add('hidden');
            document.getElementById('workspace-view').classList.remove('hidden');
            document.getElementById('tool-title').innerText = currentTool.title;
            document.getElementById('tool-desc').innerText = currentTool.desc;
            document.getElementById('file-input').accept = currentTool.accept;
        }

        function resetUI() {
            document.getElementById('drop-area').classList.remove('hidden');
            document.getElementById('editor-ui').classList.add('hidden');
            document.getElementById('status-area').classList.add('hidden');
        }

        async function handleFile(files) {
            if (currentTool.id === 'pdf-editor') {
                document.getElementById('drop-area').classList.add('hidden');
                startPdfEditor(files[0]);
            } else {
                startProcessingImplementation(files);
            }
        }

        // --- PDF EDITOR LOGIC ---
        async function startPdfEditor(file) {
            document.getElementById('editor-ui').classList.remove('hidden');
            originalPdfBytes = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: new Uint8Array(originalPdfBytes.slice(0)) }).promise;
            
            const container = document.getElementById('pages-container');
            const thumbList = document.getElementById('thumbnail-sidebar');
            container.innerHTML = ''; thumbList.innerHTML = ''; fabricCanvases = [];

            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const viewport = page.getViewport({ scale: 1.2 });
                const wrapper = document.createElement('div');
                wrapper.className = 'page-wrapper';
                wrapper.id = `page-wrap-${i-1}`;
                wrapper.style.width = `${viewport.width}px`; wrapper.style.height = `${viewport.height}px`;

                const bg = document.createElement('canvas');
                bg.width = viewport.width; bg.height = viewport.height;
                const fg = document.createElement('canvas');
                fg.id = `fg-${i}`;

                wrapper.appendChild(bg); wrapper.appendChild(fg); container.appendChild(wrapper);
                await page.render({ canvasContext: bg.getContext('2d'), viewport }).promise;

                const fCanvas = new fabric.Canvas(`fg-${i}`, { width: viewport.width, height: viewport.height });
                fabricCanvases.push(fCanvas);

                const thumb = document.createElement('div');
                thumb.className = `thumb-page ${i===1?'active':''}`;
                thumb.onclick = () => jumpToPage(i-1);
                thumb.innerHTML = `<div class="p-2 text-center text-xs font-bold">${i}</div>`;
                thumbList.appendChild(thumb);
            }
            refreshEditorStatus();
        }

        function addText() {
            const canvas = fabricCanvases[activePage];
            const text = new fabric.IText("Double click to edit", {
                left: 50, top: 50,
                fontSize: 24, fill: '#ef4444', fontWeight: 'bold'
            });
            canvas.add(text).setActiveObject(text);
        }

        async function exportFinalPDF() {
            const btn = document.getElementById('export-btn');
            btn.innerText = "Processing...";
            const pdfDoc = await PDFDocument.load(originalPdfBytes.slice(0));
            const pages = pdfDoc.getPages();
            for (let i = 0; i < fabricCanvases.length; i++) {
                const canvas = fabricCanvases[i];
                if (canvas.getObjects().length === 0) continue;
                const dataURL = canvas.toDataURL({ format: 'png', multiplier: 2 });
                const pngImage = await pdfDoc.embedPng(await fetch(dataURL).then(res => res.arrayBuffer()));
                const { width, height } = pages[i].getSize();
                pages[i].drawImage(pngImage, { x: 0, y: 0, width, height });
            }
            saveAs(new Blob([await pdfDoc.save()]), "Edited.pdf");
            btn.innerText = "EXPORT PDF";
        }

        // --- DASHBOARD UTILITIES ---
        async function startProcessingImplementation(files) {
            document.getElementById('drop-area').classList.add('hidden');
            document.getElementById('status-area').classList.remove('hidden');
            document.getElementById('loading-spinner').classList.remove('hidden');
            try {
                await currentTool.handler(files);
                document.getElementById('loading-spinner').classList.add('hidden');
                document.getElementById('success-msg').classList.remove('hidden');
            } catch (err) { alert(err.message); location.reload(); }
        }

        function setupDownload(blob, filename) {
            document.getElementById('download-btn').onclick = () => saveAs(blob, filename);
        }

        function jumpToPage(idx) {
            document.getElementById(`page-wrap-${idx}`).scrollIntoView({ behavior: 'smooth' });
            activePage = idx; refreshEditorStatus();
        }

        function refreshEditorStatus() {
            document.getElementById('page-info').innerText = `Page ${activePage + 1} / ${fabricCanvases.length}`;
        }
        
        function deleteSelected() { fabricCanvases[activePage].remove(fabricCanvases[activePage].getActiveObject()); }
        function adjustZoom(val) { scaleZoom += val; document.getElementById('pages-container').style.transform = `scale(${scaleZoom})`; }

        // Placeholder Handlers for Original Tools
        async function processMenuFixer(f) { alert("Processing Menu..."); }
        async function compressPDF(f) { alert("Compressing PDF..."); }
        async function convertJpgToPdf(f) { alert("Converting Images..."); }
    </script>
</body>
</html>
