<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Excel Menu Cleaner</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}
.container {
  max-width: 1400px;
  margin: auto;
  background: white;
  padding: 20px;
  border-radius: 10px;
}
button, select, input {
  padding: 8px;
  margin: 5px 0;
}
button {
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
button:hover { background: #1e40af; }

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
  font-size: 13px;
}
th, td {
  border: 1px solid #ddd;
  padding: 6px;
}
th { background: #f1f5f9; }

.flex { display: flex; gap: 20px; }
.half { width: 50%; }

.dupHighlight { background: #fff3cd; }     /* yellow */
.spellHighlight { background: #d1fae5; }   /* green */

.multiSelect {
  width: 300px;
  height: 120px;
}
</style>
</head>

<body>

<div class="container">
<h2>Upload Excel → Clean → Download</h2>

<input type="file" accept=".xlsx,.csv" onchange="handleFile(event)">
<br><br>

<b>Item name column (for duplicate logic)</b><br>
<select id="itemColumn"></select>
<br><br>

<b>Select columns for spell check (Ctrl + Click)</b><br>
<select id="spellColumns" class="multiSelect" multiple></select>
<br><br>

<button onclick="removeDuplicates()">Remove Duplicates</button>
<button onclick="spellCheck()">Spell Check</button>
<button onclick="downloadExcel()">Download Cleaned File</button>

<div class="flex">
  <div class="half">
    <h3>Input (Original)</h3>
    <table id="inputTable"></table>
  </div>
  <div class="half">
    <h3>Output (Cleaned)</h3>
    <table id="outputTable"></table>
  </div>
</div>

</div>

<script>
let originalData = [];
let cleanedData = [];
let headers = [];
let duplicateHighlights = new Set();
let spellingHighlights = new Set();

/* FOOD DICTIONARY */
const foodDictionary = {
  "chiken": "chicken",
  "coffe": "coffee",
  "frape": "frappe",
  "piza": "pizza",
  "sandwitch": "sandwich",
  "nudels": "noodles",
  "biriyani": "biryani"
};

/* LOAD FILE */
function handleFile(e) {
  const reader = new FileReader();
  reader.onload = evt => {
    const wb = XLSX.read(new Uint8Array(evt.target.result), { type: "array" });
    const sheet = wb.Sheets[wb.SheetNames[0]];

    originalData = XLSX.utils.sheet_to_json(sheet);
    cleanedData = JSON.parse(JSON.stringify(originalData));
    headers = Object.keys(originalData[0]);

    populateSelectors();
    renderTables();
  };
  reader.readAsArrayBuffer(e.target.files[0]);
}

/* POPULATE DROPDOWNS */
function populateSelectors() {
  const itemSel = document.getElementById("itemColumn");
  const spellSel = document.getElementById("spellColumns");

  itemSel.innerHTML = "<option value=''>Select Item Name</option>";
  spellSel.innerHTML = "";

  headers.forEach(h => {
    itemSel.innerHTML += `<option value="${h}">${h}</option>`;
    spellSel.innerHTML += `<option value="${h}">${h}</option>`;
  });
}

/* RENDER TABLES */
function renderTables() {
  renderTable("inputTable", originalData, false);
  renderTable("outputTable", cleanedData, true);
}

function renderTable(id, data, isOutput) {
  const table = document.getElementById(id);
  table.innerHTML = "";

  const headRow = document.createElement("tr");
  headers.forEach(h => {
    const th = document.createElement("th");
    th.textContent = h;
    headRow.appendChild(th);
  });
  table.appendChild(headRow);

  data.slice(0, 10).forEach((row, i) => {
    const tr = document.createElement("tr");

    if (isOutput) {
      if (duplicateHighlights.has(i)) tr.classList.add("dupHighlight");
      if (spellingHighlights.has(i)) tr.classList.add("spellHighlight");
    }

    headers.forEach(h => {
      const td = document.createElement("td");
      td.textContent = row[h];
      tr.appendChild(td);
    });

    table.appendChild(tr);
  });
}

/* DUPLICATE REMOVER (PRICE-AWARE) */
function removeDuplicates() {
  const nameCol = document.getElementById("itemColumn").value;
  if (!nameCol) return alert("Select Item Name column");

  const priceCol = "Price";
  duplicateHighlights.clear();

  const groups = {};
  cleanedData.forEach((row, idx) => {
    const key = row[nameCol]?.toLowerCase().trim();
    if (!groups[key]) groups[key] = [];
    groups[key].push({ row, idx });
  });

  const result = [];

  Object.values(groups).forEach(items => {
    if (items.length === 1) {
      result.push(items[0].row);
      return;
    }

    const priceMap = {};
    items.forEach(it => {
      const p = it.row[priceCol];
      if (!priceMap[p]) priceMap[p] = [];
      priceMap[p].push(it);
    });

    const prices = Object.keys(priceMap);

    if (prices.length > 1) {
      prices.forEach(p => {
        priceMap[p].forEach(it => {
          duplicateHighlights.add(result.length);
          result.push(it.row);
        });
      });
    } else {
      result.push(items[0].row);
    }
  });

  cleanedData = result;
  renderTables();
}

/* SPELL CHECK (AUTO + MULTI COLUMN) */
function spellCheck() {
  const selectedCols = Array.from(
    document.getElementById("spellColumns").selectedOptions
  ).map(o => o.value);

  if (selectedCols.length === 0)
    return alert("Select at least one column for spell check");

  spellingHighlights.clear();

  cleanedData.forEach((row, idx) => {
    let rowChanged = false;

    selectedCols.forEach(col => {
      if (!row[col]) return;

      let words = row[col].split(" ");
      words = words.map(w => {
        const clean = w.toLowerCase().replace(/[^a-z]/g, "");
        if (foodDictionary[clean]) {
          rowChanged = true;
          return foodDictionary[clean];
        }
        return w;
      });

      if (rowChanged) row[col] = words.join(" ");
    });

    if (rowChanged) spellingHighlights.add(idx);
  });

  renderTables();
}

/* DOWNLOAD */
function downloadExcel() {
  const ws = XLSX.utils.json_to_sheet(cleanedData);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Cleaned");
  XLSX.writeFile(wb, "cleaned_data.xlsx");
}
</script>

</body>
</html>
