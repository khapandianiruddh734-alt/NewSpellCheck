<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Excel Cleaner Tool</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}
.container {
  max-width: 1400px;
  margin: auto;
  background: white;
  padding: 20px;
  border-radius: 10px;
}
button, select, input {
  padding: 8px;
  margin: 5px 0;
}
button {
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
button:hover { background: #1e40af; }

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
  font-size: 13px;
}
th, td {
  border: 1px solid #ddd;
  padding: 6px;
}
th { background: #f1f5f9; }

.flex { display: flex; gap: 20px; }
.half { width: 50%; }

.spellHighlight { background: #d1fae5; } /* green */
.multiSelect {
  width: 300px;
  height: 120px;
}
</style>
</head>

<body>

<div class="container">
<h2>Excel Cleaner (Simple & Correct)</h2>

<input type="file" accept=".xlsx,.csv" onchange="handleFile(event)">
<br><br>

<b>Item Name column (for duplicate removal)</b><br>
<select id="itemColumn"></select>
<br><br>

<b>Columns for spell check (Ctrl + Click)</b><br>
<select id="spellColumns" class="multiSelect" multiple></select>
<br><br>

<button onclick="removeDuplicates()">Remove Duplicates</button>
<button onclick="spellCheck()">Spell Check</button>
<button onclick="downloadExcel()">Download Cleaned File</button>

<div class="flex">
  <div class="half">
    <h3>Input (Original)</h3>
    <table id="inputTable"></table>
  </div>
  <div class="half">
    <h3>Output (Cleaned)</h3>
    <table id="outputTable"></table>
  </div>
</div>
</div>

<script>
let originalData = [];
let cleanedData = [];
let headers = [];
let spellHighlights = new Set();

/* FOOD DICTIONARY */
const foodDictionary = {
  "chiken": "chicken",
  "coffe": "coffee",
  "frape": "frappe",
  "piza": "pizza",
  "sandwitch": "sandwich",
  "nudels": "noodles",
  "biriyani": "biryani"
};

/* LOAD FILE */
function handleFile(e) {
  const reader = new FileReader();
  reader.onload = evt => {
    const wb = XLSX.read(new Uint8Array(evt.target.result), { type: "array" });
    const sheet = wb.Sheets[wb.SheetNames[0]];

    originalData = XLSX.utils.sheet_to_json(sheet);
    cleanedData = JSON.parse(JSON.stringify(originalData));
    headers = Object.keys(originalData[0]);

    populateSelectors();
    renderTables();
  };
  reader.readAsArrayBuffer(e.target.files[0]);
}

/* POPULATE SELECTORS */
function populateSelectors() {
  const itemSel = document.getElementById("itemColumn");
  const spellSel = document.getElementById("spellColumns");

  itemSel.innerHTML = "<option value=''>Select Item Name</option>";
  spellSel.innerHTML = "";

  headers.forEach(h => {
    itemSel.innerHTML += `<option value="${h}">${h}</option>`;
    spellSel.innerHTML += `<option value="${h}">${h}</option>`;
  });
}

/* RENDER TABLES (PREVIEW ONLY) */
function renderTables() {
  renderTable("inputTable", originalData, false);
  renderTable("outputTable", cleanedData, true);
}

function renderTable(id, data, isOutput) {
  const table = document.getElementById(id);
  table.innerHTML = "";

  const headerRow = document.createElement("tr");
  headers.forEach(h => {
    const th = document.createElement("th");
    th.textContent = h;
    headerRow.appendChild(th);
  });
  table.appendChild(headerRow);

  data.slice(0, 10).forEach((row, i) => {
    const tr = document.createElement("tr");

    if (isOutput && spellHighlights.has(i)) {
      tr.classList.add("spellHighlight");
    }

    headers.forEach(h => {
      const td = document.createElement("td");
      td.textContent = row[h];
      tr.appendChild(td);
    });

    table.appendChild(tr);
  });
}

/* DUPLICATE REMOVER
   Rule:
   Same Item Name + Same Price â†’ keep ONE
*/
function removeDuplicates() {
  const nameCol = document.getElementById("itemColumn").value;
  if (!nameCol) return alert("Select Item Name column");

  const priceCol = "Price"; // must match Excel header

  const seen = new Set();
  const result = [];

  cleanedData.forEach(row => {
    const key = `${row[nameCol]?.toLowerCase().trim()}__${row[priceCol]}`;
    if (!seen.has(key)) {
      seen.add(key);
      result.push(row);
    }
  });

  cleanedData = result;
  renderTables();
}

/* SPELL CHECK (AUTO, MULTI-COLUMN, FULL SHEET) */
function spellCheck() {
  const cols = Array.from(
    document.getElementById("spellColumns").selectedOptions
  ).map(o => o.value);

  if (cols.length === 0)
    return alert("Select at least one column for spell check");

  spellHighlights.clear();

  cleanedData.forEach((row, idx) => {
    let changed = false;

    cols.forEach(col => {
      if (!row[col]) return;

      let words = row[col].split(" ");
      words = words.map(w => {
        const clean = w.toLowerCase().replace(/[^a-z]/g, "");
        if (foodDictionary[clean]) {
          changed = true;
          return foodDictionary[clean];
        }
        return w;
      });

      if (changed) row[col] = words.join(" ");
    });

    if (changed) spellHighlights.add(idx);
  });

  renderTables();
}

/* DOWNLOAD FULL CLEANED SHEET */
function downloadExcel() {
  const ws = XLSX.utils.json_to_sheet(cleanedData);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Cleaned");
  XLSX.writeFile(wb, "cleaned_data.xlsx");
}
</script>

</body>
</html>
